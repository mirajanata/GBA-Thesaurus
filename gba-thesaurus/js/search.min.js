var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.arrayIteratorImpl = function (a) { var b = 0; return function () { return b < a.length ? { done: !1, value: a[b++] } : { done: !0 } } }; $jscomp.arrayIterator = function (a) { return { next: $jscomp.arrayIteratorImpl(a) } }; $jscomp.makeIterator = function (a) { var b = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator]; return b ? b.call(a) : $jscomp.arrayIterator(a) }; $jscomp.arrayFromIterator = function (a) { for (var b, e = []; !(b = a.next()).done;)e.push(b.value); return e };
$jscomp.arrayFromIterable = function (a) { return a instanceof Array ? a : $jscomp.arrayFromIterator($jscomp.makeIterator(a)) };
var search = {
    initProjects: function () {
        var a = [], b = 0, e = 'PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT ?s ?L\n                                        WHERE {\n                                        VALUES ?p {skos:prefLabel skos:altLabel}\n                                        ?s a skos:Concept; ?p ?L . FILTER(lang(?L)="' + lang.ID + '")\n                                        } ORDER BY STRLEN(STR(?L)) ?L'; lang.LIST_THESAURUS_PROJECTS.forEach(function (c) {
            ws.projectJson(c.id,
                e, function (d) { a = [].concat($jscomp.arrayFromIterable(a), $jscomp.arrayFromIterable(d.results.bindings)); b += 1; b == lang.LIST_THESAURUS_PROJECTS.length && (window.fuse = new Fuse(a, { shouldSort: !0, tokenize: !0, keys: ["L.value"] })) })
        })
    }, insertSparql: function (a, b) {
        var e = $("#pageContent"); e.append('<br>\n                <div class="card border-info">\n                    <div class="card-body">\n                        <div style="">\n                            <div style="float:left;"><h3>' + lang.DB_QUERY + '&nbsp;</h3></div>\n                            <div style="float:right; min-width:210px" class="form-group">\n                                <select class="form-control" id="endpointSelect"></select>\n                            </div>\n                        </div>\n                        <div style="">\n                            <div style="float:left; width:85%;">\n                                <textarea class="form-control code" id="sparqlCode" rows="14"></textarea>\n                            </div>\n                            <div style="float:right; width:15%; padding-left: 1rem;">\n                                <fieldset class="form-group" style="display: inline-block;" id="namespacesAddin">\n                                  <span>Namespace</span>\n                                </fieldset>\n                            </div>\n                        </div>\n                        <div style="clear:both; padding-top:20px;">\n                           <div style="float:left; margin-right:10px; font-size:120%;"><strong>Output format:</strong></div>\n                           <div class="form-group" style="float:left; margin-right:10px;">\n                              <select class="form-control" id="outputFormat">\n                                <option value=\'text/html\'>HTML table</option>\n                                <option value=\'application/json\'>JSON</option>\n                                <option value=\'application/rdf+xml\'>XML</option>\n                              </select>\n                            </div>\n                            <div style="float:right;">\n                                <button id="runSparql" type="submit" class="btn btn-success" style="width:150px;">run query</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>');
        var c = $("#sparqlCode"); $("#runSparql").on("click", function (a) { window.open($("#endpointSelect").find(":selected").val() + "?query=" + encodeURIComponent(c.val()) + "&content-type=" + encodeURI($("#outputFormat").find(":selected").val()), "_blank") }); c.on("input propertychange", function (a) { ws.doc(c.val(), function (a) { a.ok ? $("#runSparql").prop("disabled", !1) : $("#runSparql").prop("disabled", !0) }) }); $.each(n, function (a, b) {
            $("#namespacesAddin").append('<div class="form-check">\n                                        <label class="form-check-label">\n                                          <input class="form-check-input" value="' +
                b + '" type="checkbox">\n                                          ' + a + "\n                                        </label>\n                                      </div>")
        }); $("#namespacesAddin :checkbox").change(function () { var a = "PREFIX " + $(this).parent().text().trim() + ":<" + $(this).val() + ">\r\n"; c.val(function (b, c) { return a + c }) }); $.each(LIST_THESAURUS_PROJECTS, function (b, c) {
            $("#endpointSelect").append('<option value="' + ws.endpoint + c.id + '">' + c.name + " (" + TOPIC + ")</option>"); -1 < a.search(c.id) && $("#endpointSelect").val("" +
                ws.endpoint + c.id)
        }); ws.docJson("PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT ?L ?D\n                                        WHERE {\n                                        <http://resource.geolba.ac.at/doc/159> skos:narrower* ?s .\n                                        ?s skos:prefLabel ?L . FILTER (lang(?L)='" + lang.ID + "') .\n                                        ?s skos:definition ?D\n                                        }", function (d) {
            e.append("<br>\n                                        <h3>" +
                EXAMPLE_QUERY + '</h3>\n                                        <table class="table table-hover" id="bmTbl">\n                                            <tbody></tbody>\n                                        </table>'); for (var g in d.results.bindings) 1 < b.length && -1 < d.results.bindings[g].L.value.search("label") && $("#bmTbl tbody").append('<tr id="' + g + '">\n                                                <td>\n                                                    <span class="fa fa-align-left text-info style=""></span>\n                                                    ' +
                    d.results.bindings[g].L.value.replace(/\+label/g, '<a href="' + page.BASE + "?uri=" + a + '">' + decodeURIComponent(b) + "</a>") + "\n                                                </td>\n                                              </tr>"), 0 > d.results.bindings[g].L.value.search("label") && $("#bmTbl tbody").append('<tr id="' + g + '">\n                                                <td>\n                                                    <span class="fa fa-align-left text-info style=""></span>\n                                                    ' +
                        d.results.bindings[g].L.value + "\n                                                </td>\n                                              </tr>"); $("#bmTbl > tbody > tr").click(function () { var b = String.fromCharCode(167); b = new RegExp(b, "g"); c.empty().val(d.results.bindings[$(this).attr("id")].D.value.replace(b, "\r\n").replace(/\+uri/g, a).replace(/\+lang/g, lang.ID)); $("#runSparql").prop("disabled", !1) })
        })
    }, insertSearchCard: function (a) {
        $("#searchInputLabel").html(lang.LABEL_SEARCH); $("#searchInput").attr("placeholder",
            lang.TIP_SEARCH); var b = $("#searchInput"); $("#searchInput").keydown(function (a) { 13 == a.which && (page.openParaLink("search=" + encodeURI(b.val())), $("#dropdown").empty(), b.val("")) }); $("#searchBtn").click(function (a) { page.openParaLink("search=" + encodeURI(b.val())); $("#dropdown").empty(); b.val("") }); b.focusout(function () { $("#dropdown").delay(300).hide(0, function () { $("#dropdown").empty(); b.val("") }) }); var e; b.on("input", function () {
                clearTimeout(e); $("#dropdown").empty(); e = setTimeout(function () {
                    var a = b.val();
                    if (0 < a.length) { $("#dropdown").show(); a = window.fuse.search(a); var d = []; $.each(a.slice(0, 10), function (a, b) { d.push(b.L.value) }); $.each(a.slice(0, 10), function (a, b) { var c = b.L.value; d.indexOf(c) !== d.lastIndexOf(c) && (c = c + ' <span class="addVoc">(' + lang[b.s.value.split("/")[3] + "Desc"].name + ")</span>"); $("#dropdown").append('<tr><td class="searchLink" onclick="document.location.href = \'' + page.BASE + "?uri=" + b.s.value + "&lang=" + lang.ID + "';\">" + c + "</td></tr>") }) }
                }, 200)
            })
    }, insertSearch: function (a) {
        var b = ["bold",
            "success", "danger", "primary"]; $("#pageContent").empty().append('<br><h3 id="title">' + lang.TITLE_SEARCHRESULTS + '</h3><p id="hits" class="lead">' + lang.HITS_SEARCHRESULTS + '"' + a + '"</p><hr><ul id="searchresults" class="searchresults"></ul>'); $("#searchresults").bind("DOMSubtreeModified", function () { $("#hits").html(lang.HITS_SEARCHRESULTS.replace("0", $("#searchresults li").length) + '"' + a + '"') }); var e = 'PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT DISTINCT ?s (MIN(?pL) AS ?title) (GROUP_CONCAT(DISTINCT ?label; separator = "$") as ?text) (MIN(?so) AS ?sort)\n                                        (MIN(?stat) AS ?Status)\n                                        WHERE {\n                                        VALUES ?n {"' +
                a.toLowerCase() + '"}\n                                        VALUES ?p {skos:prefLabel skos:altLabel skos:definition skos:scopeNote <http://purl.org/dc/terms/description>}\n                                        ?s a skos:Concept; ?p ?L . FILTER((lang(?L)="' + lang.ID + '")) .\n                                        BIND(CONCAT(STR(?p),"|",STR(?L)) AS ?label) . FILTER(regex(?L,?n,"i"))\n                                        ?s skos:prefLabel ?pL . FILTER((lang(?pL)="' + lang.ID + '"))\n                                        BIND(IF(?p=skos:prefLabel,1,2) AS ?so)\n                                        OPTIONAL {?s <http://resource.geolba.ac.at/PoolParty/schema/GBA/GBA_Status> ?st}\n                                        BIND (IF(exists{?s <http://resource.geolba.ac.at/PoolParty/schema/GBA/GBA_Status> ?st} , ?st, 0) AS ?stat)\n                                        }\n                                        GROUP BY ?s\n                                        ORDER BY ?sort\n                                        LIMIT 100';
        lang.LIST_THESAURUS_PROJECTS.forEach(function (c) {
            ws.projectJson(c.id, e, function (d) {
                d.results.bindings.forEach(function (d) {
                    if (199 < $("#searchresults li").length) return !1; $("#searchresults").append('\n                                            <li>\n                                                <a href="' + page.BASE + "?uri=" + d.s.value + "&lang=" + lang.ID + '">\n                                                    <strong>' + d.title.value + "</strong> (" + c.name + ')\n                                                </a>\n                                                <br>\n                                                <span class="searchPropTyp">URI: </span>\n                                                <span class="searchResultURI text-' +
                        b[Number(d.Status.value)] + '">\n                                                    ' + d.s.value + '\n                                                </span>\n                                                <br>\n                                                <p class="searchResultText">\n                                                    ' + search.createSearchResultsText(d.text.value, a) + "\n                                                </p>\n                                            </li>"); 199 <
                            $("#searchresults li").length && $("#hits").prepend(">")
                })
            })["catch"](function (a) { console.log(a) })
        })
    }, createSearchResultsText: function (a, b) {
        for (var e = b.toLowerCase(), c = new RegExp(e, "g"), d = b.charAt(0).toUpperCase() + b.slice(1), g = new RegExp(d, "g"), k = "", l = $jscomp.makeIterator(a.split("$")), f = l.next(); !f.done; f = l.next()) {
            f = f.value; k += f.split("|")[0].replace("http://www.w3.org/2004/02/skos/core#", '<span class="searchPropTyp">skos:').replace("http://purl.org/dc/terms/", '<span class="searchPropTyp">dcterms:') +
                "</span> - "; f = f.split("|")[1].split(". "); f = $jscomp.makeIterator(f); for (var h = f.next(); !h.done; h = f.next())h = h.value, -1 < h.search(new RegExp(b, "i")) && (k += h.replace(c, "<strong>" + e + "</strong>").replace(g, "<strong>" + d + "</strong>") + " .. "); k += "<br>"
        } return k
    }
};