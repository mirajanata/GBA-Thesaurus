var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.arrayIteratorImpl = function (b) { var a = 0; return function () { return a < b.length ? { done: !1, value: b[a++] } : { done: !0 } } }; $jscomp.arrayIterator = function (b) { return { next: $jscomp.arrayIteratorImpl(b) } }; $jscomp.makeIterator = function (b) { var a = "undefined" != typeof Symbol && Symbol.iterator && b[Symbol.iterator]; return a ? a.call(b) : $jscomp.arrayIterator(b) }; $jscomp.arrayFromIterator = function (b) { for (var a, c = []; !(a = b.next()).done;)c.push(a.value); return c };
$jscomp.arrayFromIterable = function (b) { return b instanceof Array ? b : $jscomp.arrayFromIterator($jscomp.makeIterator(b)) };
var search = {
    initProjects: function () {
        var b = [], a = 0, c = 'PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT ?s ?L\n                                        WHERE {\n                                        VALUES ?p {skos:prefLabel skos:altLabel}\n                                        ?s a skos:Concept; ?p ?L . FILTER(lang(?L)="' + lang.ID + '")\n                                        } ORDER BY STRLEN(STR(?L)) ?L'; lang.LIST_THESAURUS_PROJECTS.forEach(function (e) {
            ws.projectJson(e.id,
                c, function (c) { b = [].concat($jscomp.arrayFromIterable(b), $jscomp.arrayFromIterable(c.results.bindings)); a += 1; a == lang.LIST_THESAURUS_PROJECTS.length && (window.fuse = new Fuse(b, { shouldSort: !0, tokenize: !0, keys: ["L.value"] })) })
        })
    }, insertSparql: function (b, a) {
        var c = $("#pageContent"); c.append('<br>\n                <div class="card border-info">\n                    <div class="card-body">\n                        <div style="">\n                            <div style="float:left;"><h3>' + lang.DB_QUERY + '&nbsp;</h3></div>\n                            <div style="float:right; min-width:210px" class="form-group">\n                                <select class="form-control" id="endpointSelect"></select>\n                            </div>\n                        </div>\n                        <div style="">\n                            <div style="float:left; width:85%;">\n                                <textarea class="form-control code" id="sparqlCode" rows="14"></textarea>\n                            </div>\n                            <div style="float:right; width:15%; padding-left: 1rem;">\n                                <fieldset class="form-group" style="display: inline-block;" id="namespacesAddin">\n                                  <span>Namespace</span>\n                                </fieldset>\n                            </div>\n                        </div>\n                        <div style="clear:both; padding-top:20px;">\n                           <div style="float:left; margin-right:10px; font-size:120%;"><strong>Output format:</strong></div>\n                           <div class="form-group" style="float:left; margin-right:10px;">\n                              <select class="form-control" id="outputFormat">\n                                <option value=\'text/html\'>HTML table</option>\n                                <option value=\'application/json\'>JSON</option>\n                                <option value=\'application/rdf+xml\'>XML</option>\n                              </select>\n                            </div>\n                            <div style="float:right;">\n                                <button id="runSparql" type="submit" class="btn btn-success" style="width:150px;">run query</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>');
        var e = $("#sparqlCode"); $("#runSparql").on("click", function (a) { window.open($("#endpointSelect").find(":selected").val() + "?query=" + encodeURIComponent(e.val()) + "&content-type=" + encodeURI($("#outputFormat").find(":selected").val()), "_blank") }); e.on("input propertychange", function (a) { ws.doc(e.val(), function (a) { a.ok ? $("#runSparql").prop("disabled", !1) : $("#runSparql").prop("disabled", !0) }) }); $.each(n, function (a, b) {
            $("#namespacesAddin").append('<div class="form-check">\n                                        <label class="form-check-label">\n                                          <input class="form-check-input" value="' +
                b + '" type="checkbox">\n                                          ' + a + "\n                                        </label>\n                                      </div>")
        }); $("#namespacesAddin :checkbox").change(function () { var a = "PREFIX " + $(this).parent().text().trim() + ":<" + $(this).val() + ">\r\n"; e.val(function (b, c) { return a + c }) }); $.each(LIST_THESAURUS_PROJECTS, function (a, c) {
            $("#endpointSelect").append('<option value="' + ws.endpoint + c.id + '">' + c.name + " (" + TOPIC + ")</option>"); -1 < b.search(c.id) && $("#endpointSelect").val("" +
                ws.endpoint + c.id)
        }); ws.docJson("PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT ?L ?D\n                                        WHERE {\n                                        <http://resource.geolba.ac.at/doc/159> skos:narrower* ?s .\n                                        ?s skos:prefLabel ?L . FILTER (lang(?L)='" + lang.ID + "') .\n                                        ?s skos:definition ?D\n                                        }", function (g) {
            c.append("<br>\n                                        <h3>" +
                EXAMPLE_QUERY + '</h3>\n                                        <table class="table table-hover" id="bmTbl">\n                                            <tbody></tbody>\n                                        </table>'); for (var d in g.results.bindings) 1 < a.length && -1 < g.results.bindings[d].L.value.search("label") && $("#bmTbl tbody").append('<tr id="' + d + '">\n                                                <td>\n                                                    <span class="fa fa-align-left text-info style=""></span>\n                                                    ' +
                    g.results.bindings[d].L.value.replace(/\+label/g, '<a href="' + page.BASE + "?uri=" + b + '">' + decodeURIComponent(a) + "</a>") + "\n                                                </td>\n                                              </tr>"), 0 > g.results.bindings[d].L.value.search("label") && $("#bmTbl tbody").append('<tr id="' + d + '">\n                                                <td>\n                                                    <span class="fa fa-align-left text-info style=""></span>\n                                                    ' +
                        g.results.bindings[d].L.value + "\n                                                </td>\n                                              </tr>"); $("#bmTbl > tbody > tr").click(function () { var a = String.fromCharCode(167); a = new RegExp(a, "g"); e.empty().val(g.results.bindings[$(this).attr("id")].D.value.replace(a, "\r\n").replace(/\+uri/g, b).replace(/\+lang/g, lang.ID)); $("#runSparql").prop("disabled", !1) })
        })
    }, __selectSearchLink: function (b) {
        var a = $(".searchLink"); if (0 != a.length) {
            for (var c = 0; c < a.length && !$(a[c]).hasClass("selected"); c++);
            c >= a.length && (c = -1); c = b ? 1 > c ? a.length - 1 : c - 1 : -1 == c || c == a.length - 1 ? 0 : c + 1; a.removeClass("selected"); 0 <= c && (b = $(a[c]), b.addClass("selected"), $("#searchInput").val(b.text()))
        }
    }, insertSearchCard: function (b) {
        $("#searchInputLabel").html(lang.LABEL_SEARCH); $("#searchInput").attr("placeholder", lang.TIP_SEARCH); var a = $("#searchInput"); $("#searchInput").keydown(function (b) {
            switch (b.which) {
                case 13: page.openParaLink("search=" + encodeURI(a.val())); $("#dropdown").empty(); a.val(""); break; case 38: search.__selectSearchLink(1);
                    break; case 40: search.__selectSearchLink(0)
            }
        }); $("#searchBtn").click(function (b) { page.openParaLink("search=" + encodeURI(a.val())); $("#dropdown").empty(); a.val("") }); a.focusout(function () { $("#dropdown").delay(300).hide(0, function () { $("#dropdown").empty(); a.val("") }) }); var c; a.on("input", function () {
            clearTimeout(c); $("#dropdown").empty(); c = setTimeout(function () {
                var b = a.val(); if (0 < b.length) {
                    $("#dropdown").show(); b = window.fuse.search(b); var c = []; $.each(b.slice(0, 10), function (a, b) { c.push(b.L.value) }); $.each(b.slice(0,
                        10), function (a, b) { var d = b.L.value; c.indexOf(d) !== c.lastIndexOf(d) && (d = d + ' <span class="addVoc">(' + lang[b.s.value.split("/")[3] + "Desc"].name + ")</span>"); $("#dropdown").append('<tr><td class="searchLink" onclick="document.location.href = \'' + page.BASE + "?uri=" + b.s.value + "&lang=" + lang.ID + "';\">" + d + "</td></tr>") })
                }
            }, 200)
        })
    }, insertSearch: function (b) {
        var a = ["bold", "success", "danger", "primary"]; $("#pageContent").empty().append('<br><h3 id="title">' + lang.TITLE_SEARCHRESULTS + '</h3><p id="hits" class="lead">' +
            lang.HITS_SEARCHRESULTS + '"' + b + '"</p><hr><ul id="searchresults" class="searchresults"></ul>'); $("#searchresults").bind("DOMSubtreeModified", function () { $("#hits").html(lang.HITS_SEARCHRESULTS.replace("0", $("#searchresults li").length) + '"' + b + '"') }); var c = 'PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT DISTINCT ?s (MIN(?pL) AS ?title) (GROUP_CONCAT(DISTINCT ?label; separator = "$") as ?text) (MIN(?so) AS ?sort)\n                                        (MIN(?stat) AS ?Status)\n                                        WHERE {\n                                        VALUES ?n {"' +
                b.toLowerCase() + '"}\n                                        VALUES ?p {skos:prefLabel skos:altLabel skos:definition skos:scopeNote <http://purl.org/dc/terms/description>}\n                                        ?s a skos:Concept; ?p ?L . FILTER((lang(?L)="' + lang.ID + '")) .\n                                        BIND(CONCAT(STR(?p),"|",STR(?L)) AS ?label) . FILTER(regex(?L,?n,"i"))\n                                        ?s skos:prefLabel ?pL . FILTER((lang(?pL)="' + lang.ID + '"))\n                                        BIND(IF(?p=skos:prefLabel,1,2) AS ?so)\n                                        OPTIONAL {?s <http://resource.geolba.ac.at/PoolParty/schema/GBA/GBA_Status> ?st}\n                                        BIND (IF(exists{?s <http://resource.geolba.ac.at/PoolParty/schema/GBA/GBA_Status> ?st} , ?st, 0) AS ?stat)\n                                        }\n                                        GROUP BY ?s\n                                        ORDER BY ?sort\n                                        LIMIT 100';
        lang.LIST_THESAURUS_PROJECTS.forEach(function (e) {
            ws.projectJson(e.id, c, function (c) {
                c.results.bindings.forEach(function (c) {
                    if (199 < $("#searchresults li").length) return !1; c.title && c.s && ($("#searchresults").append('\n                                            <li>\n                                                <a href="' + page.BASE + "?uri=" + c.s.value + "&lang=" + lang.ID + '">\n                                                    <strong>' + c.title.value + "</strong> (" + e.name + ')\n                                                </a>\n                                                <br>\n                                                <span class="searchPropTyp">URI: </span>\n                                                <span class="searchResultURI text-' +
                        a[Number(c.Status.value)] + '">\n                                                    ' + c.s.value + '\n                                                </span>\n                                                <br>\n                                                <p class="searchResultText">\n                                                    ' + search.createSearchResultsText(c.text.value, b) + "\n                                                </p>\n                                            </li>"), 199 <
                        $("#searchresults li").length && $("#hits").prepend(">"))
                })
            })["catch"](function (a) { console.log(a) })
        })
    }, createSearchResultsText: function (b, a) {
        for (var c = a.toLowerCase(), e = new RegExp(c, "g"), g = a.charAt(0).toUpperCase() + a.slice(1), d = new RegExp(g, "g"), k = "", l = $jscomp.makeIterator(b.split("$")), f = l.next(); !f.done; f = l.next()) {
            f = f.value; k += f.split("|")[0].replace("http://www.w3.org/2004/02/skos/core#", '<span class="searchPropTyp">skos:').replace("http://purl.org/dc/terms/", '<span class="searchPropTyp">dcterms:') +
                "</span> - "; f = f.split("|")[1].split(". "); f = $jscomp.makeIterator(f); for (var h = f.next(); !h.done; h = f.next())h = h.value, -1 < h.search(new RegExp(a, "i")) && (k += h.replace(e, "<strong>" + c + "</strong>").replace(d, "<strong>" + g + "</strong>") + " .. "); k += "<br>"
        } return k
    }
};