var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.arrayIteratorImpl = function (d) { var b = 0; return function () { return b < d.length ? { done: !1, value: d[b++] } : { done: !0 } } }; $jscomp.arrayIterator = function (d) { return { next: $jscomp.arrayIteratorImpl(d) } }; $jscomp.makeIterator = function (d) { var b = "undefined" != typeof Symbol && Symbol.iterator && d[Symbol.iterator]; return b ? b.call(d) : $jscomp.arrayIterator(d) }; $jscomp.arrayFromIterator = function (d) { for (var b, c = []; !(b = d.next()).done;)c.push(b.value); return c };
$jscomp.arrayFromIterable = function (d) { return d instanceof Array ? d : $jscomp.arrayFromIterator($jscomp.makeIterator(d)) };
var search = {
    initProjects: function () {
        var d = [], b = 0, c = 'PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT ?s ?L\n                                        WHERE {\n                                        VALUES ?p {skos:prefLabel skos:altLabel}\n                                        ?s a skos:Concept; ?p ?L . FILTER(lang(?L)="' + lang.ID + '")\n                                        } ORDER BY STRLEN(STR(?L)) ?L'; lang.LIST_THESAURUS_PROJECTS.forEach(function (a) {
            ws.projectJson(a.id,
                c, function (a) { d = [].concat($jscomp.arrayFromIterable(d), $jscomp.arrayFromIterable(a.results.bindings)); b += 1; b == lang.LIST_THESAURUS_PROJECTS.length && (window.fuse = new Fuse(d, { shouldSort: !0, tokenize: !0, keys: ["L.value"] })) })
        })
    }, insertSparql: function (d, b) {
        var c = $("#pageContent"); c.append('<br>\n                <div class="card border-info">\n                    <div class="card-body">\n                        <div style="">\n                            <div style="float:left;"><h3>' + lang.DB_QUERY + '&nbsp;</h3></div>\n                            <div style="float:right; min-width:210px" class="form-group">\n                                <select class="form-control" id="endpointSelect"></select>\n                            </div>\n                        </div>\n                        <div style="">\n                            <div style="float:left; width:85%;">\n                                <textarea class="form-control code" id="sparqlCode" rows="14"></textarea>\n                            </div>\n                            <div style="float:right; width:15%; padding-left: 1rem;">\n                                <fieldset class="form-group" style="display: inline-block;" id="namespacesAddin">\n                                  <span>Namespace</span>\n                                </fieldset>\n                            </div>\n                        </div>\n                        <div style="clear:both; padding-top:20px;">\n                           <div style="float:left; margin-right:10px; font-size:120%;"><strong>Output format:</strong></div>\n                           <div class="form-group" style="float:left; margin-right:10px;">\n                              <select class="form-control" id="outputFormat">\n                                <option value=\'text/html\'>HTML table</option>\n                                <option value=\'application/json\'>JSON</option>\n                                <option value=\'application/rdf+xml\'>XML</option>\n                              </select>\n                            </div>\n                            <div style="float:right;">\n                                <button id="runSparql" type="submit" class="btn btn-success" style="width:150px;">run query</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>');
        var a = $("#sparqlCode"); $("#runSparql").on("click", function (d) { window.open($("#endpointSelect").find(":selected").val() + "?query=" + encodeURIComponent(a.val()) + "&content-type=" + encodeURI($("#outputFormat").find(":selected").val()), "_blank") }); a.on("input propertychange", function (d) { ws.doc(a.val(), function (a) { a.ok ? $("#runSparql").prop("disabled", !1) : $("#runSparql").prop("disabled", !0) }) }); $.each(n, function (a, d) {
            $("#namespacesAddin").append('<div class="form-check">\n                                        <label class="form-check-label">\n                                          <input class="form-check-input" value="' +
                d + '" type="checkbox">\n                                          ' + a + "\n                                        </label>\n                                      </div>")
        }); $("#namespacesAddin :checkbox").change(function () { var d = "PREFIX " + $(this).parent().text().trim() + ":<" + $(this).val() + ">\r\n"; a.val(function (a, b) { return d + b }) }); $.each(LIST_THESAURUS_PROJECTS, function (a, b) {
            $("#endpointSelect").append('<option value="' + ws.endpoint + b.id + '">' + b.name + " (" + TOPIC + ")</option>"); -1 < d.search(b.id) && $("#endpointSelect").val("" +
                ws.endpoint + b.id)
        }); ws.docJson("PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT ?L ?D\n                                        WHERE {\n                                        <http://resource.geolba.ac.at/doc/159> skos:narrower* ?s .\n                                        ?s skos:prefLabel ?L . FILTER (lang(?L)='" + lang.ID + "') .\n                                        ?s skos:definition ?D\n                                        }", function (f) {
            c.append("<br>\n                                        <h3>" +
                EXAMPLE_QUERY + '</h3>\n                                        <table class="table table-hover" id="bmTbl">\n                                            <tbody></tbody>\n                                        </table>'); for (var g in f.results.bindings) 1 < b.length && -1 < f.results.bindings[g].L.value.search("label") && $("#bmTbl tbody").append('<tr id="' + g + '">\n                                                <td>\n                                                    <span class="fa fa-align-left text-info style=""></span>\n                                                    ' +
                    f.results.bindings[g].L.value.replace(/\+label/g, '<a href="' + page.BASE + "?uri=" + d + '">' + decodeURIComponent(b) + "</a>") + "\n                                                </td>\n                                              </tr>"), 0 > f.results.bindings[g].L.value.search("label") && $("#bmTbl tbody").append('<tr id="' + g + '">\n                                                <td>\n                                                    <span class="fa fa-align-left text-info style=""></span>\n                                                    ' +
                        f.results.bindings[g].L.value + "\n                                                </td>\n                                              </tr>"); $("#bmTbl > tbody > tr").click(function () { var b = String.fromCharCode(167); b = new RegExp(b, "g"); a.empty().val(f.results.bindings[$(this).attr("id")].D.value.replace(b, "\r\n").replace(/\+uri/g, d).replace(/\+lang/g, lang.ID)); $("#runSparql").prop("disabled", !1) })
        })
    }, __selectSearchLink: function (d, b) {
        var c = $(".searchLink"); if (0 != c.length) {
            for (var a = 0; a < c.length && !$(c[a]).hasClass("selected"); a++);
            if (b) return a >= c.length ? null : $(c[a]); a >= c.length && (a = -1); a = d ? 1 > a ? c.length - 1 : a - 1 : -1 == a || a == c.length - 1 ? 0 : a + 1; c.removeClass("selected"); 0 <= a && (c = $(c[a]), c.addClass("selected"), $("#searchInput").val(c.text()))
        }
    }, insertSearchCard: function (d) {
        $("#searchInputLabel").html(lang.LABEL_SEARCH); $("#searchInput").attr("placeholder", lang.TIP_SEARCH); var b = $("#searchInput"); $("#searchInput").keydown(function (a) {
            switch (a.which) {
                case 13: if (a = search.__selectSearchLink(1, 1)) {
                    a = a.attr("data_url"); document.location.href =
                        a; break
                } page.openParaLink("search=" + encodeURI(b.val())); $("#dropdown").empty(); b.val(""); break; case 38: search.__selectSearchLink(1); break; case 40: search.__selectSearchLink(0)
            }
        }); $("#searchBtn").click(function (a) { page.openParaLink("search=" + encodeURI(b.val())); $("#dropdown").empty(); b.val("") }); b.focusout(function () { $("#dropdown").delay(300).hide(0, function () { $("#dropdown").empty(); b.val("") }) }); var c; b.on("input", function () {
            clearTimeout(c); $("#dropdown").empty(); c = setTimeout(function () {
                var a = b.val();
                if (0 < a.length) { $("#dropdown").show(); a = window.fuse.search(a); var d = []; $.each(a.slice(0, 10), function (a, b) { d.push(b.L.value) }); $.each(a.slice(0, 10), function (a, b) { var c = b.L.value; d.indexOf(c) !== d.lastIndexOf(c) && (c = c + ' <span class="addVoc">(' + lang[b.s.value.split("/")[3] + "Desc"].name + ")</span>"); $("#dropdown").append('<tr><td class="searchLink" data_url="' + page.BASE + "?uri=" + b.s.value + "&lang=" + lang.ID + '" onclick="document.location.href=\'' + page.BASE + "?uri=" + b.s.value + "&lang=" + lang.ID + "';\">" + c + "</td></tr>") }) }
            },
                200)
        })
    }, insertSearch: function (d) {
        var b = ["bold", "success", "danger", "primary"]; $("#pageContent").empty().append('<br><h3 id="title">' + lang.TITLE_SEARCHRESULTS + '</h3><p id="hits" class="lead">' + lang.HITS_SEARCHRESULTS + '"' + d + '"</p><hr><ul id="searchresults" class="searchresults"></ul>'); $("#searchresults").bind("DOMSubtreeModified", function () { $("#hits").html(lang.HITS_SEARCHRESULTS.replace("0", $("#searchresults li").length) + '"' + d + '"') }); var c = 'PREFIX skos:<http://www.w3.org/2004/02/skos/core#>\n                                        SELECT DISTINCT ?s (MIN(?pL) AS ?title) (GROUP_CONCAT(DISTINCT ?label; separator = "$") as ?text) (MIN(?so) AS ?sort)\n                                        (MIN(?stat) AS ?Status)\n                                        WHERE {\n                                        VALUES ?n {"' +
            d.toLowerCase() + '"}\n                                        VALUES ?p {skos:prefLabel skos:altLabel skos:definition skos:scopeNote <http://purl.org/dc/terms/description>}\n                                        ?s a skos:Concept; ?p ?L . FILTER((lang(?L)="' + lang.ID + '")) .\n                                        BIND(CONCAT(STR(?p),"|",STR(?L)) AS ?label) . FILTER(regex(?L,?n,"i"))\n                                        ?s skos:prefLabel ?pL . FILTER((lang(?pL)="' + lang.ID + '"))\n                                        BIND(IF(?p=skos:prefLabel,1,2) AS ?so)\n                                        OPTIONAL {?s <http://resource.geolba.ac.at/PoolParty/schema/GBA/GBA_Status> ?st}\n                                        BIND (IF(exists{?s <http://resource.geolba.ac.at/PoolParty/schema/GBA/GBA_Status> ?st} , ?st, 0) AS ?stat)\n                                        }\n                                        GROUP BY ?s\n                                        ORDER BY ?sort\n                                        LIMIT 100';
        lang.LIST_THESAURUS_PROJECTS.forEach(function (a) {
            ws.projectJson(a.id, c, function (c) {
                c.results.bindings.forEach(function (c) {
                    if (199 < $("#searchresults li").length) return !1; c.title && c.s && ($("#searchresults").append('\n                                            <li>\n                                                <a href="' + page.BASE + "?uri=" + c.s.value + "&lang=" + lang.ID + '">\n                                                    <strong>' + c.title.value + "</strong> (" + a.name + ')\n                                                </a>\n                                                <br>\n                                                <span class="searchPropTyp">URI: </span>\n                                                <span class="searchResultURI text-' +
                        b[Number(c.Status.value)] + '">\n                                                    ' + c.s.value + '\n                                                </span>\n                                                <br>\n                                                <p class="searchResultText">\n                                                    ' + search.createSearchResultsText(c.text.value, d) + "\n                                                </p>\n                                            </li>"), 199 <
                        $("#searchresults li").length && $("#hits").prepend(">"))
                })
            })["catch"](function (a) { console.log(a) })
        })
    }, createSearchResultsText: function (d, b) {
        for (var c = b.toLowerCase(), a = new RegExp(c, "g"), f = b.charAt(0).toUpperCase() + b.slice(1), g = new RegExp(f, "g"), k = "", l = $jscomp.makeIterator(d.split("$")), e = l.next(); !e.done; e = l.next()) {
            e = e.value; k += e.split("|")[0].replace("http://www.w3.org/2004/02/skos/core#", '<span class="searchPropTyp">skos:').replace("http://purl.org/dc/terms/", '<span class="searchPropTyp">dcterms:') +
                "</span> - "; e = e.split("|")[1].split(". "); e = $jscomp.makeIterator(e); for (var h = e.next(); !h.done; h = e.next())h = h.value, -1 < h.search(new RegExp(b, "i")) && (k += h.replace(a, "<strong>" + c + "</strong>").replace(g, "<strong>" + f + "</strong>") + " .. "); k += "<br>"
        } return k
    }
};